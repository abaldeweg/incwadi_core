#!/bin/bash

release=${1:-"0"}
db=${2:-"0"}

if [ "$release" == 1 ]
  then
    git fetch
    tag=$(git describe --tags "$(git rev-list --tags --max-count=1)")
    git checkout "$tag"
  else
    git pull origin main
fi

composer install
composer dump-env prod
if [ "$db" == 1 ]
  then
    bin/console doctrine:database:create
fi
bin/console doctrine:migrations:migrate -n
bin/console cache:clear
bin/console cache:warmup
chown -R www-data:www-data .
